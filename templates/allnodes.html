{% extends 'base.html' %}
{% block content %}
{% load leaflet_tags %}
{% leaflet_js %}
{% leaflet_css %}
{% leaflet_map 'mapid' %}
<div class="container">
  
  <form method="POST">
    {% csrf_token %}
   
   <div class='col-6 rounded ' id="map" style="width: 1000px;height: 500px; box-sizing:border-box; margin-top: 20px;  border-radius: 50px;">
      <div class="leaflet-control">
  </form>  
</div>



<script>
    var map = L.map('mapid').setView([37.215 ,10.12], 13);
    L.control.layers({
        
    'Satellite': L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 18,
        tileSize: 512,
        zoomOffset: -1,
        
    }),
    'Streets': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    })
}).addTo(map);
{% for nodes in all_nodes %}
    var marker = L.marker([{{nodes.Position.y}},{{nodes.Position.x}}]).addTo(map);
    // marker.bindPopup("<b>{{nodes.Client}}</b><br>Température : {{nodes.Temperature}}<br>Humidité : {{nodes.Humidity}}").openPopup();
{% endfor %}
      var markers = [];
      map.on("click", function (e) {
          // If marker is already defined, remove it before adding a new one
          if (marker) {
            map.removeLayer(marker);
          }
          // Add new marker at double-clicked location
          var marker;
          
      
        //   marker.on("dragend", function (e) {
            //var marker = e.target;
            //var position = marker.getLatLng();
            //document.getElementById("lat").value = position.lat;
            //document.getElementById("lng").value = position.lng;
         // });
        });
        //function removeAllMarkers() {
          //for (var i = 0; i < markers.length; i++) {
            //map.removeLayer(markers[i]);
          //}
          //markers = [];
        //}
      
        // Retrieve all marker positions
        function getMarkerPositions() {
          var Positions = [];
          for (var i = 0; i < markers.length; i++) {
            Positions.push(markers[i].getLatLng());
          }
          return Positions;
        }
        
  
 
    
    </script>
    
{% endblock %}